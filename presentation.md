---
theme: hashitheme.json
author: Chris van Meer
date: AT Computing
paging: HashiTalks 2023
---

# Imagine

---

# Imagine

## Consultant

---

# Imagine

## Consultant

### Task

---

# Imagine

## Consultant

### Task

```
   1. Orchestration
```

---

# Imagine

## Consultant

### Task

```
   1. Orchestration
   2. Scalable
```

---

# Imagine

## Consultant

### Task

```
   1. Orchestration
   2. Scalable
   3. Secure
```

---

# Imagine

## Consultant

### Task

```
   1. Orchestration
   2. Scalable
   3. Secure
   4. No Kubernetes
```

---

# Imagine

## Consultant

### Task

```
   1. Orchestration
   2. Scalable
   3. Secure
   4. No Kubernetes
   5. Hashi...
```

---

# Imagine

## Consultant

### Task

```
   1. Orchestration
   2. Scalable
   3. Secure
   4. No Kubernetes
   5. Hashi...
   6. Configuration as Code
```

---

# HashiCorp

```
```

---

# HashiCorp

```
```

## Nomad

```
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

```
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad

```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad
   [✓] Scalable
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad
   [✓] Scalable
   [✓] Flexible

```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad
   [✓] Scalable
   [✓] Flexible

```

## Vault

```
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad
   [✓] Scalable
   [✓] Flexible

```

## Vault

### Secrets management tool

```
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad
   [✓] Scalable
   [✓] Flexible

```

## Vault

### Secrets management tool

```
   [✓] Sensitive data
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad
   [✓] Scalable
   [✓] Flexible

```

## Vault

### Secrets management tool

```
   [✓] Sensitive data
   [✓] Secure
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad
   [✓] Scalable
   [✓] Flexible

```

## Vault

### Secrets management tool

```
   [✓] Sensitive data
   [✓] Secure
   [✓] Works with Nomad
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad
   [✓] Scalable
   [✓] Flexible

```

## Vault

### Secrets management tool

```
   [✓] Sensitive data
   [✓] Secure
   [✓] Works with Nomad
   [✓] Works with Consul
```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad
   [✓] Scalable
   [✓] Flexible

```

## Vault

### Secrets management tool

```
   [✓] Sensitive data
   [✓] Secure
   [✓] Works with Nomad
   [✓] Works with Consul
   [✓] Scalable

```

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad
   [✓] Scalable
   [✓] Flexible

```

## Vault

### Secrets management tool

```
   [✓] Sensitive data
   [✓] Secure
   [✓] Works with Nomad
   [✓] Works with Consul
   [✓] Scalable

```

## All boxes ticked

---

# HashiCorp

```
```

## Nomad

### Workload and application scheduler

```
   [✓] Containers
   [✓] Microservices
   [✓] Scalable

```

## Consul

### Service networking solution

```
   [✓] Service mesh
   [✓] Works with Nomad
   [✓] Scalable
   [✓] Flexible

```

## Vault

### Secrets management tool

```
   [✓] Sensitive data
   [✓] Secure
   [✓] Works with Nomad
   [✓] Works with Consul
   [✓] Scalable

```

## All boxes ticked

### The saga begins

---

# HashiStack

```
```

---

# HashiStack

```
 1. Three products
```

---

# HashiStack

```
 1. Three products
 2. Quick deploy
```

---

# HashiStack

```
 1. Three products
 2. Quick deploy
 3. On-premises
```

---

# HashiStack

```
 1. Three products
 2. Quick deploy
 3. On-premises
 4. Repetitive
```

---

# HashiStack

```
 1. Three products
 2. Quick deploy
 3. On-premises
 4. Repetitive
 5. No complete integration guide
```

---

# Many hours later

```
```

---

# Many hours later

## Many cups of coffee later

---

# Many hours later

## Many cups of coffee later

### Many lines of code later

---

# Many hours later

## Many cups of coffee later

### Many lines of code later

#### Many re-deployments later

---

# Many hours later

## Many cups of coffee later

### Many lines of code later

#### Many re-deployments later

##### Eureka

---

# Many hours later

## Many cups of coffee later

### Many lines of code later

#### Many re-deployments later

##### Eureka

###### **Two months work**

---

# How?

```
```

---

# How?

## Ansible

---

# How?

## Ansible

### Configuration management

---

# How?

## Ansible

### Configuration management

```
   1. Predictable
```

---

# How?

## Ansible

### Configuration management

```
   1. Predictable
   2. Idempotent
```

---

# How?

## Ansible

### Configuration management

```
   1. Predictable
   2. Idempotent
   3. Modular
```

---

# How?

## Ansible

### Configuration management

```
   1. Predictable
   2. Idempotent
   3. Modular
   4. Zero-touch
```

---

# &#128161;

## Share

---

# &#128161;

## Share

```
```

### Cloud

---

# &#128161;

## Share

```
```

### Cloud

#### Terraform

---

# &#128161;

## Share

```
```

### Cloud

#### Terraform

##### Infrastructure as code

---

# &#128161;

## Share

```
```

### Cloud

#### Terraform

##### Infrastructure as code

```
```

### Local

---

# &#128161;

## Share

```
```

### Cloud

#### Terraform

##### Infrastructure as code

```
```

### Local

#### Multipass

---

# &#128161;

## Share

```
```

### Cloud

#### Terraform

##### Infrastructure as code

```
```

### Local

#### Multipass

##### Simulates cloud environment on local VM's

---

# &#128161;

## Share

```
```

### Cloud

#### Terraform

##### Infrastructure as code

```
```

### Local

#### Multipass

##### Simulates cloud environment on local VM's

```
```

## In a repository near you

---

# &#128161;

## Share

```
```

### Cloud

#### Terraform

##### Infrastructure as code

```
```

### Local

#### Multipass

##### Simulates cloud environment on local VM's

```
```

## In a repository near you

### Save time

---

# `$ whoami`

---

# `$ whoami`

## Chris van Meer

---

# `$ whoami`

## Chris van Meer

```
```

### Consultant and trainer at AT Computing

---

# `$ whoami`

## Chris van Meer

```
```

### Consultant and trainer at AT Computing

#### Based in The Netherlands

---

# `$ whoami`

## Chris van Meer

```
```

### Consultant and trainer at AT Computing

#### Based in The Netherlands

##### Learn how to use open source products

---

# `$ whoami`

## Chris van Meer

```
```

### Consultant and trainer at AT Computing

#### Based in The Netherlands

##### Learn how to use open source products

##### Help with implementation

---

# `$ whoami`

## Chris van Meer

```
```

### Consultant and trainer at AT Computing

#### Based in The Netherlands

##### Learn how to use open source products

##### Help with implementation

```
```

### Focus on

---

# `$ whoami`

## Chris van Meer

```
```

### Consultant and trainer at AT Computing

#### Based in The Netherlands

##### Learn how to use open source products

##### Help with implementation

```
```

### Focus on

#### Networking

---

# `$ whoami`

## Chris van Meer

```
```

### Consultant and trainer at AT Computing

#### Based in The Netherlands

##### Learn how to use open source products

##### Help with implementation

```
```

### Focus on

#### Networking

#### Ansible

---

# `$ whoami`

## Chris van Meer

```
```

### Consultant and trainer at AT Computing

#### Based in The Netherlands

##### Learn how to use open source products

##### Help with implementation

```
```

### Focus on

#### Networking

#### Ansible

#### HashiCorp Portfolio

---

# `$ whoami`

## Chris van Meer

```
```

### Consultant and trainer at AT Computing

#### Based in The Netherlands

##### Learn how to use open source products

##### Help with implementation

```
```

### Focus on

#### Networking

#### Ansible

#### HashiCorp Portfolio

```
```

### Co-organizer Amsterdam HUG

---

# Demo

---

# Demo

## Goal

---

# Demo

## Goal

```
  1. Integrate Consul, Vault and Nomad
```

---

# Demo

## Goal

```
  1. Integrate Consul, Vault and Nomad
  2. Deploy a web app
```

---

# Demo

## Goal

```
  1. Integrate Consul, Vault and Nomad
  2. Deploy a web app
  3. Load balanced
```

---

# Demo

## Goal

```
  1. Integrate Consul, Vault and Nomad
  2. Deploy a web app
  3. Load balanced
  4. TLS
```

---

# Demo

## Goal

```
  1. Integrate Consul, Vault and Nomad
  2. Deploy a web app
  3. Load balanced
  4. TLS
  5. No dev mode
```

---

# Demo

## Goal

```
  1. Integrate Consul, Vault and Nomad
  2. Deploy a web app
  3. Load balanced
  4. TLS
  5. No dev mode
  6. Multipass
```

---

# Demo

## Goal

```
  1. Integrate Consul, Vault and Nomad
  2. Deploy a web app
  3. Load balanced
  4. TLS
  5. No dev mode
  6. Multipass
  7. 100% CLI
```

---

# Demo

## Goal

```
  1. Integrate Consul, Vault and Nomad
  2. Deploy a web app
  3. Load balanced
  4. TLS
  5. No dev mode
  6. Multipass
  7. 100% CLI
```

## Disclaimer

---

# Demo

## Goal

```
  1. Integrate Consul, Vault and Nomad
  2. Deploy a web app
  3. Load balanced
  4. TLS
  5. No dev mode
  6. Multipass
  7. 100% CLI
```

## Disclaimer

### This is only meant for a demo / test environment

```
   For this demo, server roles have been combined to limit the number of instances.
   Please do not replicate this in a production environment. Read through all of the
   reference architecture plans on the developer portal.

   Also, in a production environment, do not save your bootstrap output to a file, for
   Vault you can safely distribute the unseal keys to the key-share holders by means of
   PGP.
```

---

# Demo

## Schematic overview

```






                           
                           
                                                    +---server1---+     +---server2---+     +---server3---+         
                                                    |             |     |             |     |             |         
                                                    | Consul (C)  |     | Consul (C)  |     | Consul (C)  |         
                                                    | Vault  (V)  | <-> | Vault  (V)  | <-> | Vault  (V)  |         
                                                    | Nomad  (N)  |     | Nomad  (N)  |     | Nomad  (N)  |         
                                                    |             |     |             |     |             |         
                                                    +-------------+     +-------------+     +-------------+         
                                                           |                   |                   |
                                                           +-------------------+-------------------+
                                                                               |
                                                                               +                    
                                             +---client1---+   +---client2---+   +---client3---+   +---client4---+
                                             |             |   |             |   |             |   |             |
                                             |  C + V + N  |   |  C + V + N  |   |  C + V + N  |   |  C + V + N  |
                                             |  ---------  |   |  ---------  |   |  ---------  |   |  ---------  |
                                             |   Traefik   |   |   Web App   |   |   Web App   |   |   Web App   |
                                             |             |   |             |   |             |   |             |
                                             +-------------+   +-------------+   +-------------+   +-------------+
```

---

# Demo

## Setup

### General Deployment

#### Multipass

```
   1. Deploys instances
   2. Creates Ansible inventory
   3. Modifies local hosts file

   Playbook run took 0 days, 0 hours, 2 minutes, 38 seconds

```

#### General server configuration

```
   1. Install hashicorp repository + binaries
   2. Install docker (on clients)
   3. Install and configure dnsmasq
   4. Pip packages for Ansible to connect to Vault and Nomad
   5. Basic packages like atop, jq, lynx, tree

   Playbook run took 0 days, 0 hours, 5 minutes, 7 seconds
```

---

# Demo

## Setup

### PKI

```
   1. Creates a self-signed Certificate Authority
   2. Distributes the CA certificate to servers and clients
   3. Places the CA certificate in the trusted store
   4. Creates a certificate for our web app

   Playbook run took 0 days, 0 hours, 0 minutes, 27 seconds
```

---

# Demo

## Setup

### Consul

```
   1. Creates a Consul CA, server and client certificates
   2. Creates an encryption key
   3. Consul is bootstrapped - token is saved on workstation
   4. Several Consul policies are created
   5. Default Consul policy is modified
      a. To allow DNS lookups for dnsmasq
   6. CNI (Container Network Interface) plugin is installed

   Playbook run took 0 days, 0 hours, 1 minutes, 2 seconds
```

---

# Demo

## Setup

### Vault

```
   1. Creates a TLS certificate for the Vault nodes
      a. Signed by our private CA
   2. Uses Consul as storage backend
      a. Creates Consul ACL tokens for Vault
   3. Initializes Vault on server1
   4. Unseals the Vault
   5. Creates admin policy
   6. Creates admin user - password is saved on workstation
   7. Enables kv/2 secrets engine
   8. Revokes initial root token
   9. Enables logrotate for Vault
   10. Enables auditing to file

   Playbook run took 0 days, 0 hours, 0 minutes, 36 seconds
```

---

# Demo

## Setup

### Nomad

```
   1. Creates a Nomad policy in Consul
   2. Creates Consul ACL tokens for Nomad servers and clients
   3. Nomad is bootstrapped - token is saved on workstation
   4. Nomad token for operator is created

   Playbook run took 0 days, 0 hours, 0 minutes, 52 seconds
```

---

# Demo

## Setup

### Nomad + Vault integration && Nomad demo jobs

#### Nomad / Vault integration

```
   1. Creates a Vault policy for the demo apps
   2. Creates a Nomad server role in Vault
   3. Places the web app certificate in Vault

   Playbook run took 0 days, 0 hours, 0 minutes, 11 seconds
```

#### Demo jobs

```
   1. Starts Traefik
   2. Starts AT-Demo

   Playbook run took 0 days, 0 hours, 0 minutes, 6 seconds
```

---

# Demo

## Result

### Traefik

```
   1. Traefik is registered within Consul
   2. Retrieves TLS certificates from Vault

```

### Web App

```
   1. Pulls a container image
   2. Registers itself within Consul
   3. Registers itself within Traefik through tags
   4. Can be scaled to fit your need
```

---

# Demo

## Recap

### We created a local infrastructure that

```
   1. Runs an integrated stack of HashiCorp products
   2. Showcases how you can deliver content on this platform
   3. That allow for you to test a deployment
   4. Or use this during a demonstration
   5. And we had some CLI-fun
```

---

# Epilogue

## Resources

```
  1. Repository     https://github.com/chrisvanmeer/at-hashi-demo
  2. Presentation   https://github.com/chrisvanmeer/hashitalks-2023
```

## Contact

```
1. Email            c.v.meer@atcomputing.nl
2. Website          https://chrisvanmeer.nl
3. GitHub           https://github.com/chrisvanmeer
4. LinkedIn         https://linkedin.com/in/chrisvanmeer
5. Reddit           https://www.reddit.com/user/chrisvanmeer
                    https://www.reddit.com/r/hashicorp
                    https://www.reddit.com/r/consul
6. Discord          https://discord.gg/devopslounge
7. Meetup           https://www.meetup.com/amsterdam-hashicorp-user-group
```

---
